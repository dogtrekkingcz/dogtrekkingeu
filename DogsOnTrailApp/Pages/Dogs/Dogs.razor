@page "/pets"

@using MapsterMapper
@using DogsOnTrailApp.Models

@inject Protos.Dogs.Dogs.DogsClient DogsClient
@inject IStringLocalizer<Resource> localizer
@inject IMapper mapper
@inject NavigationManager NavManager

<h3>@localizer["Dogs.Title"]</h3>

<table>
    <thead>
        <tr>
            <th>@localizer["Dogs.Chip"]</th>
            <th>@localizer["Dogs.Name"]</th>
            <th>@localizer["Dogs.Kennel"]</th>
            <th>@localizer["Dogs.Pedigree"]</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var dog in _dogs)
        {
            <tr>
                <td>@dog.Chip</td>
                <td>@dog.Name</td>
                <td>@dog.Kennel</td>
                <td>@dog.Pedigree</td>
            </tr>
        }
    </tbody>
</table>
<button @onclick="@(() => AddDog())" class="btn btn-primary">@localizer["Dogs.AddDog"]</button>  

@code {
    private IList<DogModel> _dogs { get; set; } = new List<DogModel>();
    
    protected override async Task OnInitializedAsync()
    {
        await ReloadData();
    }

    private async Task ReloadData()
    {
        Protos.Dogs.GetAllDogs.GetAllDogsResponse response = await DogsClient.getAllDogsAsync(new Protos.Dogs.GetAllDogs.GetAllDogsRequest());

        _dogs = response.Dogs
            .Select(dog => mapper.Map<DogModel>(dog))
            .ToList();
    }

    protected void AddDog()
    {
        NavManager.NavigateTo($"/dogsadd");
    }
}